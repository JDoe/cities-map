/*! cities-map - v0.0.1 - 2014-01-08
* https://github.com/StartupWeekend/cities-map
* Copyright (c) 2014 David Pierce; Licensed MIT */
(function(t,e){e["true"]=t,function(t,e){var n=t.CitiesMap=t.CitiesMap||{},i=n.Data={};i.loadCitiesData=function(t){var n,i;return t=t||{},n={urlBase:"http://swoop.startupweekend.org"},i=e.extend(n,t),e.get(""+i.urlBase+"/cities")}}(window,"undefined"==typeof jQuery203?jQuery:jQuery203),function(t){var e,n=window.google,i=window.jQuery203===void 0?window.jQuery:window.jQuery203,r=t.CitiesMap=t.CitiesMap||{},a=r.MapApi=function(n,r){var a,o={programsOfInterest:[],disableDefaultUI:!0,zoomControl:!0,showActiveCityToggle:!1,styles:[{stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"on"},{color:"#e0ded8"}]},{featureType:"landscape",stylers:[{visibility:"on"},{color:"#f4f2eb"}]},{featureType:"administrative",stylers:[{visibility:"on"}]}]},s=this;this.mapContainer=n,this.options=i.extend(o,r||{}),this.options.notificationUrl="http://startupweekend.us1.list-manage.com/subscribe/post?u=77bee8d6876e3fd1aa815badb&amp;id=66eed7c427",this.knownPrograms=["Bootcamp","LeanStartup","Marketing","Meetup","NEXT","SW Corporate","Social","Startup Weekend","Summit"],this.mapRef=null,this.mapPoints={},this.markers={},this.searchControl=null,this.mapControlsContainer=null,this.activeCityToggle=null,this.writeMapToElement(),this.addFilterControlToMap();var l=["showActiveCityToggle"].reduce(function(t,e){return t||s.options[e]===!0},!1);return l&&(this.mapControlsContainer=document.createElement("div"),this.mapControlsContainer.setAttribute("class","mapCustomControls"),a=i(this.mapControlsContainer),a.click(function(){a.hasClass("open")?a.removeClass("open"):a.addClass("open")}),this.mapRef.controls[e.ControlPosition.TOP_RIGHT].push(this.mapControlsContainer)),this.options.showActiveCityToggle&&this.addActiveCityToggle(),t.MarkerClusterer&&(this.clusterManager=new t.MarkerClusterer(this.mapRef,[],{maxZoom:8,minimumClusterSize:4,calculator:function(t){return{text:t.length===void 0?0:t.length,index:0}},styles:[{height:53,width:53,url:"https://s3.amazonaws.com/up-global-cms/misc-assets/up-global-map-grouping.png"}]})),this};e=n&&n.maps?n.maps:void 0,e===void 0?window.alert("The Google Maps API is not available at this time. Please try again later"):(a.prototype.writeMapToElement=function(){var t,n,i=this,r=i.mapContainer,a=i.options;return a.center=a.center?new e.LatLng(a.center[0],a.center[1]):new e.LatLng(51.4791,0),a.zoom=a.zoom||2,a.mapTypeId=e.MapTypeId.ROADMAP,i.mapRef=new e.Map(r[0],a),i.infoWindowInstance=new e.InfoWindow({map:i.mapRef}),n=a.width||r.data("width")||600,t=a.height||r.data("height")||400,r.css("width",n),r.css("height",t),this.mapRef},a.prototype.createCityPoint=function(t,n){var i=new e.Marker({map:this.mapRef,position:new e.LatLng(t.location[0],t.location[1]),icon:"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|00f09d|00f09d|00f09d"});return i.addListener("click",n),this.mapPoints[i.__gm_id]=t,this.markers[i.__gm_id]=i,this.clusterManager&&this.clusterManager.addMarker(i),i}),a.prototype.getMarkerShowHandler=function(){var t=this,e=t.mapRef,n=t.infoWindowInstance;return function(i){var r=this,a=r.__gm_id,o=t.mapPoints[a];return n.setContent(t.getCityInfoWindowContent(o)),n.open(e,r),i.stop(),!1}},a.prototype.getCityInfoWindowContent=function(t){var e=this,n="<div class='sw-cities-map'>",i=e.options.programsOfInterest;return 0===i.length&&(i=e.knownPrograms),n+=i.map(function(n){var i,r="",a=null;return t.upcoming_programs.some(function(t){return t.event_type===n?(a=t,!0):!1}),r+="<h1>"+n+" "+t.city+"</h1>",i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),n="x"===t?e:8|3&e;return n.toString(16)}),r+=a&&a.events&&a.events.length>0?a.events.map(function(r){var a,o,s=e.formatDateString(r.start_date);return r.website&&r.website.length>0&&(a=/^https?\:\/\//.test(r.website)?n.website:"http://"+r.website),r.public_registration_url&&r.public_registration_url.length>0&&(o=/^https?:\/\//.test(r.public_registration_url)?r.public_registration_url:"http://"+r.public_registration_url),a=a||o||"http://www.startupweekend.org",o=o||a||"http://www.startupweekend.org","<div class='event-row'><p class='event-row__date'>"+s+(r.vertical.length>0?" - "+r.vertical:"")+"</p>"+"<span class='event-row__form-controls'><a href='"+a+"'>More Info</a></span>"+"<span class='event-row__form-controls'><a href='"+o+"'>Sign up</a></span>"+"<label for='"+i+"' class='event-row__notification-trigger'>Future event alerts</label>"+"<input id='"+i+"' type='checkbox' class='event-row__activate-form' />"+"<div class='event-row__form-target'>"+"<form action='"+e.options.notificationUrl+"' method='POST' target='_blank'>"+"<input type='hidden' name='CITY' value='"+t.city+"' />"+"<input type='hidden' name='MMERGE3' value='"+n+"' />"+"<input type='hidden' name='MMERGE4' value='"+r.vertical+"' />"+"<input type='text' name='EMAIL' placeholder='Email Address' /><input type='submit' name='Subscribe' value='Subscribe' />"+"</form></div>"+"</div>"}).join(""):"<div class='event-row'><p class='event-row__date'>No upcoming events</p><span class='event-row__form-controls'><a href=' "+e.programOrganizeRegistrationUrl(n)+"' target='_blank'>Organize an event</a></span>"+"<label for='"+i+"' class='event-row__notification-trigger'>Future event alerts</label>"+"<input id='"+i+"' type='checkbox' class='event-row__activate-form' />"+"<div class='event-row__form-target'>"+"<form action='"+e.options.notificationUrl+"' method='POST' target='_blank'>"+"<input type='hidden' name='CITY' value='"+t.city+"' />"+"<input type='hidden' name='MMERGE3' value='"+n+"' />"+"<input type='hidden' name='MMERGE4' value='' />"+"<input type='text' name='EMAIL' placeholder='Email Address'/><input type='submit' name='Subscribe' value='Subscribe' />"+"</form>"+"</div>"+"</div>"}).join(""),n+="</div>"},a.prototype.programOrganizeRegistrationUrl=function(t){switch(t){case"Startup Weekend":return"http://startupweekend.org/organizer/application/";case"NEXT":return"http://www.swnext.co/get-involved/apply";default:return"http://www.up.co/get-involved/become-leader"}},a.prototype.formatDateString=function(t){var e,n,i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=["January","February","March","April","May","June","July","August","September","October","November","December"];return"string"==typeof t&&(t=new Date(t)),e=i[t.getUTCDay()],n=r[t.getUTCMonth()],e+", "+n+" "+t.getUTCDate()},a.prototype.addFilterControlToMap=function(){var t=document.createElement("input"),n=this;t.type="search",t.setAttribute("results",""),t.className="map-city-filter",n.mapRef.controls[e.ControlPosition.TOP_RIGHT].push(t),i(t).on("search",o(n.handleSearchFilter,n)),i(t).on("keyup",o(n.handleSearchFilter,n)),n.searchControl=t},a.prototype.addActiveCityToggle=function(){var t=this,e=document.createElement("input"),n=document.createElement("label");e.setAttribute("type","checkbox"),e.setAttribute("id","activeCityCheckbox"),n.setAttribute("for","activeCityCheckbox"),n.textContent="Show Cities This Weekend",i(e).change(o(t.toggleActiveCities,t)),t.mapControlsContainer.appendChild(e),t.mapControlsContainer.appendChild(n),t.activeCityToggle=e};var o=function(t,e){var n=e;return function(){t.call(n,arguments)}};a.prototype.handleSearchFilter=function(){var t=this,n=t.searchControl.value,r=i(t.searchControl),a=RegExp("^"+n,"i"),o=[];if(Object.keys(t.markers).forEach(function(e){""===n||a.test(t.mapPoints[e].city)?(t.markers[e].setVisible(!0),n.length>0&&o.push(e)):t.markers[e].setVisible(!1)}),i(t.mapContainer).find(".search-results").children().remove(),i(t.mapContainer).find(".search-results").remove(),n&&n.length>0){var s=i("<ul />",{"class":"search-results"}).css({position:"absolute",top:r.position().top+r.outerHeight()+parseInt(r.css("margin-top"),10),left:r.position().left,width:r.outerWidth()-1});o.forEach(function(e){var n=t.mapPoints[e],r=[n.city];n.state&&r.push(n.state),n.country&&r.push(n.country),s.append(i("<li />").text(r.join(", ")).data("markerid",e))}),s.find("li").on("click",function(n){var a=i(n.currentTarget),o=a.data("markerid"),s=t.mapPoints[o];t.mapRef.setCenter(new e.LatLng(s.location[0],s.location[1])),t.mapRef.setZoom(12),r.val(i(a).text()),i(t.mapContainer).find(".search-results").remove()}),i(t.searchControl).after(s)}},a.prototype.findNextMonday=function(t){var e,n;return e=8-t.getDay(),e=8===e?1:e,n=new Date(t.getTime()+864e5*e)},a.prototype.toggleActiveCities=function(){var t,e=this,n=e.activeCityToggle.checked;t=e.findNextMonday(new Date),this.clusterManager&&(n?this.clusterManager.setMinimumClusterSize(9999):this.clusterManager.setMinimumClusterSize(4),this.clusterManager.repaint()),Object.keys(e.markers).forEach(function(i){var r,a,o=e.options.programsOfInterest,s=!1;n?(r=e.mapPoints[i].upcoming_programs.filter(function(t){return o.indexOf(t.event_type)>=0}),a=r.some(function(e){return e.events.some(function(e){return t>=new Date(e.start_date)})}),s=a?!0:!1):s=!0,e.markers[i].setVisible(s)})}}(window),function(t,e){var n=e.Data,i=document.createElement("style"),r=".sw-cities-map input[type=checkbox]{visibility:hidden}.sw-cities-map .event-row{border-bottom:1px solid #e1e1e1;padding-bottom:1em}.sw-cities-map .event-row:last-child{border-bottom:0}.sw-cities-map .event-row__notification-trigger{color:green;text-decoration:underline;cursor:pointer}.sw-cities-map .event-row__form-controls:after{content:' | '}.sw-cities-map .event-row__form-target{display:block;height:0;opacity:0;overflow:hidden;transition:height .4s ease-in}.sw-cities-map .event-row__activate-form:checked+.event-row__form-target{display:block;height:1.5em;opacity:1;font-size:2em}.search-results{margin:0;list-style:none;padding-left:0;height:60%;overflow:scroll}.search-results li{background-color:#fff;cursor:pointer;padding:.8em .5em;width:auto;font-family:Helvetica,sans-serif}.search-results li:hover{background-color:#77a5cf}.gm-style-iw{padding-bottom:4em}";i.type="text/css",i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r));var a=document.head||document.getElementsByTagName("head")[0];a.insertBefore(i,a.firstChild),t.fn.citiesmap=function(i){var r=t(this),a=n.loadCitiesData(i);a.error(function(t){window.alert(t)}),a.success(function(t){var n=new e.MapApi(r,i),a=n.getMarkerShowHandler();t.forEach(function(t){n.createCityPoint.call(n,t,a)})})}}("undefined"==typeof jQuery203?jQuery:jQuery203,CitiesMap)})({},function(){return this}());