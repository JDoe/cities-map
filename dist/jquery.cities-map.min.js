/*! cities-map - v0.0.1 - 2013-12-18
* https://github.com/TheDahv/cities-map
* Copyright (c) 2013 David Pierce; Licensed MIT */
(function(e,t){t["true"]=e,function(e,t){var a=e.CitiesMap=e.CitiesMap||{},r=a.Data={};r.loadCitiesData=function(e){var a,r;return e=e||{},a={urlBase:"http://swoop.startupweekend.org"},r=t.extend(a,e),t.get(""+r.urlBase+"/cities")}}(window,jQuery),function(e){var t,a=window.google,r=window.jQuery,i=e.CitiesMap=e.CitiesMap||{},n=i.MapApi=function(t,a){var i={programsOfInterest:[],disableDefaultUI:!0,styles:[{stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"on"},{color:"#e0ded8"}]},{featureType:"landscape",stylers:[{visibility:"on"},{color:"#f4f2eb"}]},{featureType:"administrative",stylers:[{visibility:"on"}]}]};return this.mapContainer=t,this.options=r.extend(i,a||{}),this.options.notificationUrl="http://startupweekend.us1.list-manage.com/subscribe/post?u=77bee8d6876e3fd1aa815badb&amp;id=66eed7c427",this.knownPrograms=["Bootcamp","LeanStartup","Marketing","Meetup","NEXT","SW Corporate","Social","Startup Weekend","Summit"],this.mapRef=null,this.mapPoints={},this.markers={},this.searchControl=null,this.writeMapToElement(),this.addFilterControlToMap(),e.MarkerClusterer&&(this.clusterManager=new e.MarkerClusterer(this.mapRef,[],{maxZoom:8,minimumClusterSize:4})),this};t=a&&a.maps?a.maps:void 0,t===void 0?window.alert("The Google Maps API is not available at this time. Please try again later"):(n.prototype.writeMapToElement=function(){var e,a,r=this,i=r.mapContainer,n=r.options;return n.center=n.center?new t.LatLng(n.center[0],n.center[1]):new t.LatLng(51.4791,0),n.zoom=n.zoom||2,n.mapTypeId=t.MapTypeId.ROADMAP,r.mapRef=new t.Map(i[0],n),r.infoWindowInstance=new t.InfoWindow({map:r.mapRef}),a=n.width||i.data("width")||600,e=n.height||i.data("height")||400,i.css("width",a),i.css("height",e),this.mapRef},n.prototype.createCityPoint=function(e,a){var r=new t.Marker({map:this.mapRef,position:new t.LatLng(e.location[0],e.location[1]),icon:"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|00f09d|00f09d|00f09d"});return r.addListener("click",a),this.mapPoints[r.__gm_id]=e,this.markers[r.__gm_id]=r,this.clusterManager&&this.clusterManager.addMarker(r),r}),n.prototype.getMarkerShowHandler=function(){var e=this,t=e.mapRef,a=e.infoWindowInstance;return function(r){var i=this,n=i.__gm_id,o=e.mapPoints[n];return a.setContent(e.getCityInfoWindowContent(o)),a.open(t,i),r.stop(),!1}},n.prototype.getCityInfoWindowContent=function(e){var t=this,a="<div class='sw-cities-map'>",r=t.options.programsOfInterest;return 0===r.length&&(r=t.knownPrograms),a+=r.map(function(a){var r,i="",n=null;return e.upcoming_programs.some(function(e){return e.event_type===a?(n=e,!0):!1}),i+="<h1>"+a+" "+e.city+"</h1>",r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),a="x"===e?t:8|3&t;return a.toString(16)}),i+=n&&n.events&&n.events.length>0?n.events.map(function(i){var n,o,s=t.formatDateString(i.start_date);return i.website&&i.website.length>0&&(n=/^https?\:\/\//.test(i.website)?a.website:"http://"+i.website),i.public_registration_url&&i.public_registration_url.length>0&&(o=/^https?:\/\//.test(i.public_registration_url)?i.public_registration_url:"http://"+i.public_registration_url),n=n||o||"http://www.startupweekend.org",o=o||n||"http://www.startupweekend.org","<div class='event-row'><p class='event-row__date'>"+s+(i.vertical.length>0?" - "+i.vertical:"")+"</p>"+"<span class='event-row__form-controls'><a href='"+n+"'>More Info</a></span>"+"<span class='event-row__form-controls'><a href='"+o+"'>Sign up</a></span>"+"<label for='"+r+"' class='event-row__notification-trigger'>Future event alerts</label>"+"<input id='"+r+"' type='checkbox' class='event-row__activate-form' />"+"<div class='event-row__form-target'>"+"<form action='"+t.options.notificationUrl+"' method='POST' target='_blank'>"+"<input type='hidden' name='CITY' value='"+e.city+"' />"+"<input type='hidden' name='MMERGE3' value='"+a+"' />"+"<input type='hidden' name='MMERGE4' value='"+i.vertical+"' />"+"<input type='text' name='EMAIL' placeholder='Email Address' /><input type='submit' name='Subscribe' value='Subscribe' />"+"</form></div>"+"</div>"}).join(""):"<div class='event-row'><p class='event-row__date'>No upcoming events</p><span class='event-row__form-controls'><a href=' "+t.programOrganizeRegistrationUrl(a)+"' target='_blank'>Organize an event</a></span>"+"<label for='"+r+"' class='event-row__notification-trigger'>Future event alerts</label>"+"<input id='"+r+"' type='checkbox' class='event-row__activate-form' />"+"<div class='event-row__form-target'>"+"<form action='"+t.options.notificationUrl+"' method='POST' target='_blank'>"+"<input type='hidden' name='CITY' value='"+e.city+"' />"+"<input type='hidden' name='MMERGE3' value='"+a+"' />"+"<input type='hidden' name='MMERGE4' value='' />"+"<input type='text' name='EMAIL' placeholder='Email Address'/><input type='submit' name='Subscribe' value='Subscribe' />"+"</form>"+"</div>"+"</div>"}).join(""),a+="</div>"},n.prototype.programOrganizeRegistrationUrl=function(e){switch(e){case"Startup Weekend":return"http://startupweekend.org/organizer/application/";case"NEXT":return"http://www.swnext.co/get-involved/apply";default:return"http://www.up.co/get-involved/become-leader"}},n.prototype.formatDateString=function(e){var t,a;switch("string"==typeof e&&(e=new Date(e)),e.getUTCDay()){case 0:t="Monday";break;case 1:t="Tuesday";break;case 2:t="Wednesday";break;case 3:t="Thursday";break;case 4:t="Friday";break;case 5:t="Saturday";break;case 6:t="Sunday"}switch(e.getUTCMonth()){case 0:a="January";break;case 1:a="February";break;case 2:a="March";break;case 3:a="April";break;case 4:a="May";break;case 5:a="June";break;case 6:a="July";break;case 7:a="August";break;case 8:a="September";break;case 9:a="October";break;case 10:a="November";break;case 11:a="December";break;default:a=""}return t+", "+a+" "+e.getUTCDate()},n.prototype.addFilterControlToMap=function(){var e=document.createElement("input"),a=this;e.type="search",e.setAttribute("results",""),e.className="map-city-filter",a.mapRef.controls[t.ControlPosition.TOP_RIGHT].push(e),r(e).on("search",o(a.handleSearchFilter,a)),r(e).on("keyup",o(a.handleSearchFilter,a)),a.searchControl=e};var o=function(e,t){var a=t;return function(){e.call(a,arguments)}};n.prototype.handleSearchFilter=function(){var e=this,a=e.searchControl.value,i=r(e.searchControl),n=RegExp("^"+a,"i"),o=[];if(Object.keys(e.markers).forEach(function(t){""===a||n.test(e.mapPoints[t].city)?(e.markers[t].setVisible(!0),a.length>0&&o.push(t)):e.markers[t].setVisible(!1)}),r(e.mapContainer).find(".search-results").children().remove(),r(e.mapContainer).find(".search-results").remove(),a&&a.length>0){var s=r("<ul />",{"class":"search-results"}).css({position:"absolute",top:i.offset().top+i.height()-8,left:i.offset().left-8,width:i.outerWidth()-1});o.forEach(function(t){var a=e.mapPoints[t],i=[a.city];a.state&&i.push(a.state),a.country&&i.push(a.country),s.append(r("<li />").text(i.join(", ")).data("markerid",t))}),s.find("li").on("click",function(a){var n=r(a.currentTarget),o=n.data("markerid"),s=e.mapPoints[o];e.mapRef.setCenter(new t.LatLng(s.location[0],s.location[1])),e.mapRef.setZoom(12),i.val(r(n).text()),r(e.mapContainer).find(".search-results").remove()}),r(e.searchControl).after(s)}}}(window),function(e,t){var a=t.Data,r=document.createElement("style"),i=".sw-cities-map input[type=checkbox]{visibility:hidden}.sw-cities-map .event-row{border-bottom:1px solid #e1e1e1;padding-bottom:1em}.sw-cities-map .event-row:last-child{border-bottom:0}.sw-cities-map .event-row__notification-trigger{color:green;text-decoration:underline;cursor:pointer}.sw-cities-map .event-row__form-controls:after{content:' | '}.sw-cities-map .event-row__form-target{display:block;height:0;opacity:0;overflow:hidden;transition:height .4s ease-in}.sw-cities-map .event-row__activate-form:checked+.event-row__form-target{display:block;height:1.5em;opacity:1;font-size:2em}.search-results{margin:0;list-style:none;padding-left:0;height:60%;overflow:scroll}.search-results li{background-color:#fff;cursor:pointer;padding:.8em .5em;width:auto;font-family:Helvetica,sans-serif}.search-results li:hover{background-color:#77a5cf}.gm-style-iw{padding-bottom:4em}";r.type="text/css",r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i));var n=document.head||document.getElementsByTagName("head")[0];n.insertBefore(r,n.firstChild),e.fn.citiesmap=function(r){var i=e(this),n=a.loadCitiesData(r);n.error(function(e){window.alert(e)}),n.success(function(e){var a=new t.MapApi(i,r),n=a.getMarkerShowHandler();e.forEach(function(e){a.createCityPoint.call(a,e,n)})})}}(jQuery,CitiesMap)})({},function(){return this}());